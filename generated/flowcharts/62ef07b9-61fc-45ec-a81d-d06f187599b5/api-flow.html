<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입 플로우(스타일 적용) - API Flow</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter,+Pretendard,+sans-serif&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
    <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/cytoscape-dagre@2.4.0/cytoscape-dagre.js"></script>
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', ' Pretendard', ' sans-serif';
    background: #E9F5EE;
    color: #2E7D32;
    height: 100vh;
    overflow: hidden;
    font-weight: 400;
}

.header {
    background: rgba(255, 255, 255, 0.95);
    border-bottom: 1px solid #2E7D32;
    padding: 20px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 1px 0 rgba(0,0,0,0.05);
    z-index: 100;
    position: relative;
}

.header h1 {
    font-size: 18px;
    font-weight: 600;
    color: #2E7D32;
    display: flex;
    align-items: center;
    gap: 12px;
    letter-spacing: -0.01em;
}

.header-icon {
    width: 24px;
    height: 24px;
    background: #2E7D32;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
    font-weight: 600;
}

.main {
    height: calc(100vh - 81px);
    position: relative;
    background: rgba(255, 255, 255, 0.9);
    margin: 20px;
    border: 1px solid #2E7D32;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    border-radius: 12px;
    overflow: hidden;
}

#cy {
    width: 100%;
    height: 100%;
    background: #E9F5EE;
}

.controls {
    position: absolute;
    top: 24px;
    left: 24px;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid #2E7D32;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    border-radius: 12px;
    display: flex;
    padding: 4px;
    gap: 2px;
}

.btn {
    padding: 10px 16px;
    border: none;
    background: transparent;
    font-family: 'Inter', ' Pretendard', ' sans-serif', sans-serif;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s ease;
    color: #525252;
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
    border-radius: 8px;
}

.btn:hover {
    background: rgba(255,255,255,0.8);
    color: #1a1a1a;
}

.btn.active {
    background: #2E7D32;
    color: #ffffff;
}

.loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #2E7D32;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(255,255,255,0.9);
    padding: 24px 32px;
    border-radius: 12px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
}

.loading::before {
    content: '';
    width: 18px;
    height: 18px;
    border: 2px solid rgba(0,0,0,0.1);
    border-top: 2px solid #2E7D32;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

    </style>
</head>
<body>
    <div class="header">
        <h1>
            <div class="header-icon">FL</div>
            회원가입 플로우(스타일 적용)
        </h1>
        <div class="header-actions">
            <button class="btn" onclick="fitGraph()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 3h6v6H3V3zm8 0h6v6h-6V3zM3 11h6v6H3v-6zm8 0h6v6h-6v-6z"/>
                </svg>
                전체 보기
            </button>
        </div>
    </div>

    <div class="main">
        <div id="loading" class="loading">플로우차트 생성 중...</div>
        <div id="cy" style="display: none;"></div>

        <div class="controls">
            <button class="btn active" onclick="changeLayout('dagre')">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 3h18v4H3V3zm0 6h18v4H3V9zm0 6h18v4H3v-4z"/>
                </svg>
                다이어그램
            </button>
            <button class="btn" onclick="changeLayout('hierarchy')">계층형</button>
            <button class="btn" onclick="changeLayout('breadthfirst')">방사형</button>
            <button class="btn" onclick="changeLayout('circle')">원형</button>
        </div>
    </div>

    <script>
        if (typeof cytoscape !== 'undefined' && typeof dagre !== 'undefined') {
            cytoscape.use(cytoscapeDagre);
        }

        let cy = null;

        document.addEventListener('DOMContentLoaded', function() {
            initializeCytoscape();
        });

        function initializeCytoscape() {
            try {
                cy = cytoscape({
                    container: document.getElementById('cy'),
                    elements: [
{
  "data": {
    "id": "A",
    "label": "Client",
    "type": "external",
    "nodeClass": "primary",
    "method": "",
    "endpoint": ""
  }
},
{
  "data": {
    "id": "B",
    "label": "Auth API",
    "type": "service",
    "nodeClass": "primary",
    "method": "",
    "endpoint": ""
  }
},
{
  "data": {
    "id": "V1",
    "label": "Validate Input",
    "type": "service",
    "nodeClass": "",
    "method": "",
    "endpoint": ""
  }
},
{
  "data": {
    "id": "X",
    "label": "Check Duplicate Email",
    "type": "service",
    "nodeClass": "",
    "method": "",
    "endpoint": ""
  }
},
{
  "data": {
    "id": "H",
    "label": "Hash Password",
    "type": "service",
    "nodeClass": "",
    "method": "",
    "endpoint": ""
  }
},
{
  "data": {
    "id": "U",
    "label": "Create User",
    "type": "service",
    "nodeClass": "",
    "method": "",
    "endpoint": ""
  }
},
{
  "data": {
    "id": "C",
    "label": "Users DB",
    "type": "db",
    "nodeClass": "accent",
    "method": "",
    "endpoint": ""
  }
},
{
  "data": {
    "id": "A-B",
    "source": "A",
    "target": "B",
    "label": "POST /signup JSON",
    "styleType": "thick"
  }
},
{
  "data": {
    "id": "B-V1",
    "source": "B",
    "target": "V1",
    "label": "PARSE & SANITIZE",
    "styleType": ""
  }
},
{
  "data": {
    "id": "V1-X",
    "source": "V1",
    "target": "X",
    "label": "OK",
    "styleType": ""
  }
},
{
  "data": {
    "id": "X-C",
    "source": "X",
    "target": "C",
    "label": "SELECT BY EMAIL",
    "styleType": "dotted"
  }
},
{
  "data": {
    "id": "C-X",
    "source": "C",
    "target": "X",
    "label": "RESULT",
    "styleType": "dotted"
  }
},
{
  "data": {
    "id": "X-A",
    "source": "X",
    "target": "A",
    "label": "EXISTS: 409 CONFLICT",
    "styleType": "dotted"
  }
},
{
  "data": {
    "id": "X-H",
    "source": "X",
    "target": "H",
    "label": "NOT EXISTS",
    "styleType": ""
  }
},
{
  "data": {
    "id": "H-U",
    "source": "H",
    "target": "U",
    "label": "BCRYPT/SCRYPT",
    "styleType": ""
  }
},
{
  "data": {
    "id": "U-C",
    "source": "U",
    "target": "C",
    "label": "INSERT USER",
    "styleType": ""
  }
},
{
  "data": {
    "id": "C-B",
    "source": "C",
    "target": "B",
    "label": "OK",
    "styleType": ""
  }
},
{
  "data": {
    "id": "B-A",
    "source": "B",
    "target": "A",
    "label": "201 CREATED",
    "styleType": "thick"
  }
}
],
                    style: [{
    selector: 'node',
    style: {
        'label': 'data(label)',
        'text-valign': 'center',
        'text-halign': 'center',
        'font-family': 'Inter,+Pretendard,+sans-serif',
        'font-size': '12px',
        'font-weight': '600',
        'color': '#2E7D32',
        'text-wrap': 'wrap',
        'text-max-width': '120px',
        'width': '110px',
        'height': '65px',
        'border-width': 2,
        'transition-duration': '0.2s',
        'overlay-opacity': 0.05
    }
},
{
    selector: 'node[type = "external"]',
    style: {
        'background-color': '#E9F5EE',
        'border-color': '#2E7D32',
        'shape': 'ellipse',
        'width': '120px',
        'height': '70px'
    }
},
{
    selector: 'node[type = "service"]',
    style: {
        'background-color': '#E9F5EE',
        'border-color': '#2E7D32',
        'shape': 'rectangle',
        'width': '110px',
        'height': '65px'
    }
},
{
    selector: 'node[type = "db"]',
    style: {
        'background-color': '#E9F5EE',
        'border-color': '#2E7D32',
        'shape': 'round-rectangle',
        'width': '105px',
        'height': '70px'
    }
},
{
    selector: 'node[nodeClass = "accent"]',
    style: {
        'background-color': '#FFF3E0',
        'border-color': '#F57C00'
    }
},
{
    selector: 'node[nodeClass = "muted"]',
    style: {
        'background-color': '#F5F5F5',
        'border-color': '#9E9E9E'
    }
},
{
    selector: 'node[nodeClass = "primary"]',
    style: {
        'background-color': '#E3F2FD',
        'border-color': '#1976D2'
    }
},
{
    selector: 'edge',
    style: {
        'curve-style': 'straight',
        'target-arrow-shape': 'triangle',
        'target-arrow-color': '#2E7D32',
        'line-color': '#2E7D32',
        'width': 2,
        'label': 'data(label)',
        'font-size': '11px',
        'font-weight': '500',
        'font-family': 'Inter,+Pretendard,+sans-serif',
        'color': '#2E7D32',
        'text-background-color': 'rgba(255,255,255,0.9)',
        'text-background-opacity': 1,
        'text-background-padding': '4px',
        'source-distance-from-node': 5,
        'target-distance-from-node': 5
    }
},
{
    selector: 'edge[styleType = "thick"]',
    style: {
        'width': 4,
        'line-color': '#2E7D32',
        'target-arrow-color': '#2E7D32'
    }
},
{
    selector: 'edge[styleType = "dotted"]',
    style: {
        'line-style': 'dotted',
        'width': 2
    }
}
],
                    layout: {
                        name: 'dagre',
                        directed: true,
                        padding: 50,
                        spacingFactor: 1.3,
                        animate: true,
                        animationDuration: 500,
                        rankDir: 'LR'
                    }
                });

                // 이벤트 핸들러
                cy.on('tap', 'node', function(evt) {
                    console.log('Node clicked:', evt.target.data());
                });

                // 로딩 완료
                document.getElementById('loading').style.display = 'none';
                document.getElementById('cy').style.display = 'block';

                setTimeout(() => cy.fit(null, 40), 100);

            } catch (error) {
                console.error('Cytoscape 초기화 오류:', error);
                document.getElementById('loading').textContent = '로드 중 오류가 발생했습니다';
            }
        }

        function fitGraph() {
            if (cy) cy.fit(null, 50);
        }

        function changeLayout(layoutName) {
            if (!cy) return;

            const layouts = {
                'dagre': {
                    name: 'dagre',
                    directed: true,
                    padding: 50,
                    spacingFactor: 1.3,
                    animate: true,
                    animationDuration: 500,
                    rankDir: 'LR'
                },
                'hierarchy': {
                    name: 'breadthfirst',
                    directed: true,
                    padding: 50,
                    spacingFactor: 1.4,
                    animate: true,
                    animationDuration: 500
                },
                'breadthfirst': {
                    name: 'breadthfirst',
                    directed: true,
                    padding: 50,
                    spacingFactor: 1.6,
                    animate: true,
                    animationDuration: 500
                },
                'circle': {
                    name: 'circle',
                    padding: 60,
                    animate: true,
                    animationDuration: 500
                }
            };

            cy.layout(layouts[layoutName]).run();

            document.querySelectorAll('.controls .btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
