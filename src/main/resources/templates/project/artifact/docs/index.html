<style>
    .endpoint-card {
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        margin-bottom: 16px;
        background: var(--white);
    }

    .endpoint-header {
        padding: 12px 16px;
        background: var(--background-gray);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .endpoint-summary {
        font-weight: 500;
        font-size: 14px;
    }

    .endpoint-body {
        padding: 16px;
    }

    .method-badge {
        display: inline-block;
        padding: 2px 8px;
        font-size: 11px;
        font-weight: 600;
        border-radius: 3px;
        margin-right: 8px;
    }

    .method-get { background: #10b981; color: white; }
    .method-post { background: #3b82f6; color: white; }
    .method-put { background: #f59e0b; color: white; }
    .method-delete { background: #ef4444; color: white; }
    .method-patch { background: #8b5cf6; color: white; }

    .param-item, .response-item {
        background: var(--background-gray);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        padding: 12px;
        margin-bottom: 8px;
    }

    .param-header, .response-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .param-type {
        font-size: 11px;
        padding: 2px 6px;
        background: var(--primary-color);
        color: white;
        border-radius: 3px;
    }

    .json-editor {
        background: #1e293b;
        color: #e2e8f0;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 12px;
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        min-height: 120px;
        white-space: pre;
        overflow: auto;
    }

    .collapsible {
        cursor: pointer;
    }

    .collapsible:hover {
        background: rgba(37, 99, 235, 0.05);
    }

    .json-preview {
        background: #0f172a;
        color: #e2e8f0;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 12px;
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        max-height: 420px;
        overflow: auto;
        padding: 16px;
        white-space: pre;
    }

    .btn-group {
        display: inline-flex;
        gap: 6px;
    }

    .param-content,
    .response-content {
        margin-top: 12px;
    }

    .param-table-wrapper {
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        overflow: hidden;
    }

    .param-table th,
    .param-table td {
        vertical-align: middle;
        background: var(--white);
    }

    .param-table tbody tr:nth-child(2n+1) td {
        background: var(--background-gray-light, #f8fafc);
    }

    .param-detail-row td {
        background: var(--background-gray);
    }

    .param-detail {
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        padding: 16px;
        background: var(--white);
    }

    .request-body-card {
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        background: var(--white);
    }

    .font-monospace {
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    }
</style>
<div class="container max-w-100">
    <form id="apiDocsForm" th:attr="data-project-idx=${projectIdx},data-docs-idx=${idx}">
        <input type="hidden" name="docsIdx" th:value="${idx}">
        <input type="hidden" name="projectIdx" th:value="${projectIdx}">
        <!-- 기본 정보 -->
        <div class="card mb-4">
            <div class="card-header">
                <h2><i class="fas fa-info-circle"></i> 기본 정보</h2>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-2">
                    <div class="form-group">
                        <label class="form-label">제목</label>
                        <input type="text" class="form-control" id="title" placeholder="예: 주문 API" required
                               th:value="${docs != null ? docs.title : ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">버전</label>
                        <input type="text" class="form-control" id="version" placeholder="예: 1.0.0" required
                               th:value="${docs != null ? docs.version : ''}">
                    </div>
                </div>
            </div>
        </div>

        <!-- 엔드포인트 목록 -->
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h2><i class="fas fa-code"></i> API 엔드포인트</h2>
                    <button type="button" class="btn btn-primary btn-sm" id="addEndpointBtn">
                        <i class="fas fa-plus"></i> 엔드포인트 추가
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="endpointsList">
                    <div class="empty-state">
                        <i class="fas fa-code"></i>
                        <p>엔드포인트를 추가해 주세요.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- JSON 미리보기 -->
        <div class="card mt-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h2><i class="fas fa-code-branch"></i> JSON 미리보기</h2>
                <span class="text-muted" style="font-size: 12px;">유효한 JSON 형식으로 스키마/콘텐츠를 입력하세요.</span>
            </div>
            <div class="card-body">
                <pre id="apiJsonPreview" class="json-preview">{
              "title": "",
              "version": "",
              "endpoints": []
            }</pre>
            </div>
        </div>

        <!-- 저장 버튼 -->
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary" id="downloadBtn">
                            <i class="fas fa-download"></i> 다운로드
                        </button>
                        <button type="submit" class="btn btn-primary" id="saveBtn">
                            <i class="fas fa-save"></i>
                            <span th:text="${idx != null} ? '문서 수정' : '문서 저장'">문서 저장</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
<div style="display: none;" id="apiDocsInitialData" th:text="${apiDocsSpec}"></div>
<script>
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeContent);
    } else {
        initializeContent();
    }

    function initializeContent() {
        if (window.ApiDocsManager) {
            window.apiDocsManager = new ApiDocsManager();
        } else {
            // 대체 로직
            setTimeout(initializeContent, 50); // 재시도
        }
    }
</script>
